<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)--> <!--(Document created with RoboEditor. )============================--> <!--(==============================================================)-->


<!-- Mirrored from www.hgy413.com/hgydocs/IA32/instruct32_hh/MWAIT--Monitor_Wait.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 16:30:10 GMT -->
<head>

<title>MWAIT - 監視器等待</title>

<!--(Meta)==========================================================-->

<meta http-equiv=content-type content="text/html; charset=utf-8">
<meta name=date content="05 12, 2003 2:15:01 PM">
<meta name=topic-status content="In Progress">
<meta name=topic-priority content=0>
<meta name=topic-time-estimate content=0>
<meta name=topic-comment content>
<meta name=topic-id content="MWAIT--Monitor Wait">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1565>
<meta name=layout-width content=792>


<!--(Links)=========================================================-->

 <link rel='stylesheet' href='MSL_styl_ns.css'>
<script type="text/javascript" language="JavaScript" title="WebHelpSplitCss">
<!--
if (navigator.appName !="Netscape")
{   document.write("<link rel='stylesheet' href='MSL_styl.css'>");}
//-->
</script>
<style type="text/css">
<!--
table.whs1 {margin-top: 14pt; x-border-left: 1px table-solid; x-border-top: 1px table-solid; x-border-right: 1px table-solid; x-border-bottom: 1px table-solid; border-collapse: separate; border-spacing: 3px; x-border-left: 1px table-solid; x-border-top: 1px table-solid; x-border-right: 1px table-solid; x-border-bottom: 1px table-solid; border-collapse: separate; border-spacing: 3px;}
td.whs2 {x-cell-content-align: CENTER; padding-left: 3px; padding-top: 3px; padding-right: 3px; padding-bottom: 3px;}
-->
</style>
<script type="text/javascript" language="JavaScript" title="WebHelpInlineScript">
<!--
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//-->
</script>
<style type="text/css">
<!--
  div.WebHelpPopupMenu {position:absolute; left:0px; top:0px; z-index:4; visibility:hidden;}
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../whtopic.js"></script>
</head>

<!--(Body)==========================================================-->


<body>

<script type="text/javascript" language="javascript1.2">
<!--
if (window.gbWhTopic)
{
	if (window.addTocInfo)
	{
	addTocInfo("參考\n指令集\nIA-32 指令\nM - 指令\nMWAIT - 監視器等待");

	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(0);

	if (window.setRelStartPage)
	{
	setRelStartPage("../reference_olh.html");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();
//-->
</script>
<h1>MWAIT - 監視器等待</h1>

<!--(Table)=========================================================-->
<table x-use-null-cells wrapperparagraphselector="P" cellspacing="3" border="1" class="whs1">

<tr>
<td valign="middle" class="whs2">
<h3 CLASS=TableHead
	style="margin-bottom: 0;">&nbsp;</td>
<td valign="middle" class="whs2">
<h3 CLASS=TableHead
	style="margin-bottom: 0;">指令</td>
<td valign="middle" class="whs2">
<h3 CLASS=TableHead
	style="margin-bottom: 0;">說明</td></tr>

<tr>
<td colspan="1" rowspan="1" valign="middle" class="whs2">
<p CLASS=TableCell>&nbsp;</td>
<td colspan="1" rowspan="1" valign="middle" class="whs2">
<p CLASS=TableCell>MWAIT EAX, ECX</td>
<td colspan="1" rowspan="1" valign="middle" class="whs2">
<p CLASS=TableCell>這是一個提示，允許處理器停止指令執行，並進入取決於具體版本的優化狀態，直到發生某類事件。 </td></tr>
</table>

<p>&nbsp;</p>

<h2>說明</h2>

<p>MWAIT 指令設計用於配合 <a HREF="MONITOR--Setup_Monitor_Address.html">MONITOR</a> 指令使用，以便允許處理器發出以下訊號：等待的地址 (MONITOR) 與導致等待操作開始的指令 (MWAIT)。MWAIT 指令也是一個提示，在處理器等待事件，或等待對地址範圍（由程式流中的前一條 MONITOR 指令設定）的儲存期間，它提示處理器可以選擇進入取決於具體版本的狀態。 </p>

<p>具體版本可能會選擇忽略此提示，繼續執行下一條指令。將來具體的處理器版本可能會實現多個優化的等待狀態，並根據提示參數選擇這些狀態。</p>

<p>在將來的處理器設計中，EAX 與 ECX 將用於同 MWAIT 指令就其它資訊進行通訊，如處理器應該進入的優化狀態種類。ECX 指定 MWAIT 指令可選的擴充套件。EAX 可能包含一些提示，如處理器應該進入的首選優化狀態。對於含 SSE3 的英特爾<font style="font-family: Verdana, Arial, Helvetica, sans-serif;" 													face=Verdana>(R)</font> 奔騰<font style="font-family: Verdana, Arial, Helvetica, sans-serif;" 				face=Verdana>(R)</font> 4 處理器，EAX 與 ECX 的所有非零值都是保留值。如果在 ECX 等於保留值的情況下執行 MWAIT 指令，處理器將產生一般保護性錯誤。處理器忽略 EDX 中保留位的設定。</p>

<p>對 MONITOR 指令設定的地址範圍的儲存、中斷、NMI、SMI、除錯異常、機器檢查異常、BINIT# 訊號、INIT# 訊號或 RESET# 訊號都將退出優化狀態。請注意，僅當優化狀態是在啟用中斷的情況下進入的，中斷才會導致處理器退出優化的狀態。如果對地址範圍的儲存導致處理器退出，則會從跟在 MWAIT 指令後面的指令處恢復執行。如果中斷（包括 NMI）導致處理器退出優化狀態，則處理器將退出優化狀態並處理該中斷。如果 SMI 導致處理器退出優化狀態，則在處理完 SMI 之後，從跟在 MWAIT 後面的指令處恢復執行。與 HALT 指令不同，MWAIT 指令不支援在 MWAIT 指令處重新啟動。可能還有其它一些取決於具體版本的事件或超時會導致處理器退出優化狀態，並從跟在 MWAIT 後面的指令處恢復執行。 </p>

<p>如果前一條 MONITOR 指令未成功設定地址範圍，或是執行 MWAIT 之前，未執行 MONITOR 指令，則處理器將不會進入優化狀態。此時將從跟在 MWAIT 後面的指令處恢復執行。</p>

<p>MWAIT 指令可以在任何特權級別執行。MONITOR CPUID 功能標誌（在 EAX=1 的情況下執行 CPUID 時，是 ECX 的位 3）指示處理器是否支援此指令。操作系統或系統 BIOS 可以通過 IA32_MISC_ENABLES MSR 禁用此指令；禁用此指令會清除 CPUID 功能標誌，並導致執行 MWAIT 指令時產生非法操作碼異常</p>

<h2>操作 </h2>

<p class=Preformatted>// MWAIT takes the argument inEAX as a hint extension and is </p>

<p class=Preformatted>// architected to take the argument in ECX as an instruction extension  </p>

<p class=Preformatted>// MWAIT EAX, ECX  </p>

<p class=Preformatted>{ WHILE (! (&quot;monitor_event_pending_flag&quot; OR &quot;monitor_not_active&quot;)) {  </p>

<p class=Preformatted
	style="margin-left: 40px;">implementation_dependent_optimized_state(EAX, ECX);  </p>

<p class=Preformatted
	style="margin-left: 0px;">} </p>

<p class=Preformatted
	style="margin-left: 0px;">Clear monitor_event_pending_flag;  </p>

<p class=Preformatted
	style="margin-left: 0px;">} </p>

<h2>示例</h2>

因為執行 MWAIT 指令將清除監視器地址範圍，所以 MONITOR 與 MWAIT 指令必須在相同的循環中編碼。不可能在循環中執行 MONITOR 一次，然後再執行 MWAIT。設定 MONITOR 而不執行 MWAIT 時，沒有任何負面影響。假設存在一個全域性共享的可變整數觸發器，它在處理器進入 MWAIT 之前寫入零 (0x0)，並由要喚醒此觸發器的其它執行緒/處理器寫入一 (0x1)。 

<p class=Preformatted>Trigger = 0;</p>

<p class=Preformatted>If ( !trigger) {  </p>

<p class=Preformatted
	style="margin-left: 40px;">EAX = &amp;trigger  </p>

<p class=Preformatted
	style="margin-left: 40px;">ECX = 0 </p>

<p class=Preformatted
	style="margin-left: 40px;">EDX = 0 </p>

<p class=Preformatted
	style="margin-left: 40px;">MONITOR EAX, ECX, EDX </p>

<p class=Preformatted
	style="margin-left: 40px;">If ( !trigger ) <span style="margin-left: 0px;">{ </span></p>

<p class=Preformatted
	style="margin-left: 40px;">EAX = 0 </p>

<p class=Preformatted
	style="margin-left: 40px;">ECX = 0 </p>

<p class=Preformatted
	style="margin-left: 40px;">MWAIT EAX, ECX </p>

<p class=Preformatted
	style="margin-left: 40px;">} </p>

<p class=Preformatted
	style="margin-left: 0px;"><span style="margin-left: 40px;">} </span></p>

上述程式碼序列確保在第一次檢查觸發器與執行監視器指令之間，不會進行觸發儲存。如果沒有第二次檢查，觸發儲存將暗中進行。MONITOR 與 MWAIT 的典型用法是上述循環中的程式碼序列。 

<h2>異常</h2>

無

<h2>數值異常</h2>

無

<h2>保護模式異常</h2>

#GP(0) - ECX 的值不是 0。

<br>#UD - 如果 CPUID 功能標誌 MONITOR 為 0。如果使用 LOCK 字首。 

<h2>實地址模式異常</h2>

#GP(0) - ECX 的值不是 0。

<br>#UD - 如果 CPUID 功能標誌 MONITOR 為 0。如果使用 LOCK 字首。 

<h2>虛 8086 模式異常</h2>

#GP(0) - ECX 的值不是 0。

<br>#UD - 如果 CPUID 功能標誌 MONITOR 為 0。如果使用 LOCK 字首。 

<script type="text/javascript" language="javascript1.2">
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);
//-->
</script>
</body>


<!-- Mirrored from www.hgy413.com/hgydocs/IA32/instruct32_hh/MWAIT--Monitor_Wait.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 16:30:11 GMT -->
</html>
