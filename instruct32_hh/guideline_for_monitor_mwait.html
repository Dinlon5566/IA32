<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)--> <!--(Document created with RoboEditor. )============================--> <!--(==============================================================)-->


<!-- Mirrored from www.hgy413.com/hgydocs/IA32/instruct32_hh/guideline_for_monitor_mwait.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 16:55:48 GMT -->
<head>

<title>MONITOR/MWAIT 指導原則</title>

<!--(Meta)==========================================================-->

<meta http-equiv=content-type content="text/html; charset=utf-8">
<meta name=date content="05 12, 2003 1:06:05 PM">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1079>
<meta name=layout-width content=720>


 <meta name="topic-status" content="In Progress">
 <meta name="topic-priority" content="0">
 <meta name="topic-time-estimate" content="0">
 <meta name="topic-comment" content="">
 <meta name="topic-id" content="Guideline for MONITOR/MWAIT"><!--(Links)=========================================================-->

 <link rel='stylesheet' href='https://www.hgy413.com/hgydocs/IA32/instruct32_hh/MSL_styl_ns.css'>
<script type="text/javascript" language="JavaScript" title="WebHelpSplitCss">
<!--
if (navigator.appName !="Netscape")
{   document.write("<link rel='stylesheet' href='https://www.hgy413.com/hgydocs/IA32/instruct32_hh/MSL_styl.css'>");}
//-->
</script>
<style type="text/css">
<!--
ul.whs1 {list-style: disc;}
-->
</style>
<script type="text/javascript" language="JavaScript" title="WebHelpInlineScript">
<!--
function reDo() {
  if (innerWidth != origWidth || innerHeight != origHeight)
     location.reload();
}
if ((parseInt(navigator.appVersion) == 4) && (navigator.appName == "Netscape")) {
	origWidth = innerWidth;
	origHeight = innerHeight;
	onresize = reDo;
}
onerror = null; 
//-->
</script>
<style type="text/css">
<!--
  div.WebHelpPopupMenu {position:absolute; left:0px; top:0px; z-index:4; visibility:hidden;}
-->
</style>
<script type="text/javascript" language="javascript1.2" src="https://www.hgy413.com/hgydocs/IA32/whmsg.js"></script>
<script type="text/javascript" language="javascript" src="https://www.hgy413.com/hgydocs/IA32/whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="https://www.hgy413.com/hgydocs/IA32/whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="https://www.hgy413.com/hgydocs/IA32/whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="https://www.hgy413.com/hgydocs/IA32/whtopic.js"></script>
</head>

<!--(Body)==========================================================-->


<body>

<script type="text/javascript" language="javascript1.2">
<!--
if (window.gbWhTopic)
{
	if (window.addTocInfo)
	{
	
	}
	if (window.writeBtnStyle)
		writeBtnStyle();

	if (window.writeIntopicBar)
		writeIntopicBar(0);

	if (window.setRelStartPage)
	{
	setRelStartPage("https://www.hgy413.com/hgydocs/IA32/reference_olh.htm");

		autoSync(1);
		sendSyncInfo();
		sendAveInfoOut();
	}
}
else
	if (window.gbIE4)
		document.location.reload();
//-->
</script>
<h1>MONITOR/MWAIT 指導原則</h1>

<p>提供 <a HREF="https://www.hgy413.com/hgydocs/IA32/instruct32_hh/MONITOR--Setup_Monitor_Address.htm">MONITOR</a> 與 <a HREF="https://www.hgy413.com/hgydocs/IA32/instruct32_hh/MWAIT--Monitor_Wait.htm">MWAIT</a> 目的是爲了改善多個代理之間的同步。在含&ldquo;第三代數據流單指令多數據擴充套件指令集&rdquo;(SSE3) 的英特爾&#xAE; 奔騰&#xAE; 4 處理器的實現中，MONITOR/MWAIT 的目標是供系統軟體用於提供更有效的執行緒同步原件。MONITOR 定義用於監視寫回儲存的地址範圍。MWAIT 用於指示軟體執行緒正在等待對地址範圍（MONITOR 指令定義）的寫回儲存。</p>

<h2>MONITOR/MWAIT 地址範圍的確定</h2>

<p>軟體應知道 MONITOR/MWAIT 要監視寫入的區域的準確長度。分配與使用的區域比處理器觸發區域的長度短時，可能會導致錯誤的喚醒（由於向錯誤地放入觸發區域的數據變數進行寫入所導致）。相反，分配的區域長度大於觸發區域時，可能會導致無法適時喚醒處理器。CPUID 可以確定觸發區域的準確長度。此長度與系統中的任何快取線大小都沒有關係，軟體不應該對它的影響作任何假設。基於 CPUID 提供的大小，操作系統/軟體應動態分配含適當填充間隙的結構。如果正確的分配導致問題，請選擇不使用 MONTIOR/MWAIT。</p>

<p>對於基於單個群集的系統，應該使用單個長度來滿足要求；可以預見，為包含多個群集的系統設定數據佈局會更加複雜。在這樣的系統中，根據晶片組實現的機制，單個監視快取線大小可能不足以滿足要求。 
 </p>

<p>通常情況下，軟體將監視一組數據變數的寫入。確定這些變數在監視器觸發區域中的位置非常必要。為消除寫入其它變數導致的錯誤喚醒，軟體需要在監視的變數周圍新增填充間隙。這也稱為間隙區域。 </p>

<p>另請參閱：<a HREF="https://www.hgy413.com/hgydocs/IA32/instruct32_hh/vc46.htm">CPUID - CPU 標識</a></p>

<h2>來自 MWAIT 的喚醒</h2>

<p>多個事件（對觸發地址範圍的寫入除外）可能導致喚醒執行 MWAIT 的處理器。這些包括：</p>

<ul type="disc" class="whs1">
	
	<li class=kadov-p><p>外部中斷：NMI、SMI、INIT、BINIT、MCERR</p></li>
	
	<li class=kadov-p><p>包括&ldquo;機器檢查&rdquo;在內的錯誤、終止</p></li>
	
	<li class=kadov-p><p>體系結構層面的 TLB 失效，包括寫入 CR0、CR3、CR4，以及某些 MSR 寫入</p></li>
	
	<li class=kadov-p><p>快速系統呼叫與遠呼叫導致的自行轉換</p></li>
</ul>

<p>電源管理相關事件（如&ldquo;溫度監視器&rdquo;）或晶片組驅動的 STP-CLK# 聲言不會導致清除&ldquo;監視器事件未決&rdquo;位。除錯陷阱與錯誤不會導致清除&ldquo;監視器事件未決&rdquo;位。 </p>

<p>下例顯示 MONITOR/MWAIT 的典型用法。</p>

<h3>MONITOR/MWAIT 用法偽程式碼</h3>

<p class=Preformatted>// Trigger[MONITORDATARANGE] is the memory address range that will be  </p>

<p class=Preformatted>// used as the trigger data range Trigger[0] = 0;</p>

<p class=Preformatted
	style="margin-left: 40px;">If ( trigger[0] != TRIGERRDATAVALUE) {</p>

<p class=Preformatted
	style="margin-left: 80px;">EAX = &amp;trigger[0]</p>

<p class=Preformatted
	style="margin-left: 80px;">ECX = 0</p>

<p class=Preformatted
	style="margin-left: 80px;">EDX = 0</p>

<p class=Preformatted
	style="margin-left: 80px;">MONITOR EAX, ECX, EDX</p>

<p class=Preformatted
	style="margin-left: 80px;">If (trigger[0] != TRIGERRDATAVALUE ) {</p>

<p class=Preformatted
	style="margin-left: 120px;">EAX = 0</p>

<p class=Preformatted
	style="margin-left: 120px;">ECX = 0</p>

<p class=Preformatted
	style="margin-left: 120px;">MWAIT EAX, ECX</p>

<p class=Preformatted
	style="margin-left: 80px;">}</p>

<p class=Preformatted
	style="margin-left: 40px;">}</p>

<script type="text/javascript" language="javascript1.2">
<!--
if (window.writeIntopicBar)
	writeIntopicBar(0);
//-->
</script>
</body>


<!-- Mirrored from www.hgy413.com/hgydocs/IA32/instruct32_hh/guideline_for_monitor_mwait.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 08 Sep 2022 16:55:48 GMT -->
</html>
